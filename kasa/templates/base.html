{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS:GO Kasa Açma Sitesi</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
      body {
        font-family: 'Open Sans', sans-serif;
        background-color: #121418;
        color: #fff;
        margin: 0;
        padding: 0;
      }
      .navbar {
        background-color: #1e2125;
        border-bottom: 1px solid #2c3034;
        padding: 0.5rem 1rem;
      }
      .navbar-brand {
        color: #ffc107;
        font-size: 1.8rem;
        font-weight: 700;
        margin-right: 2rem;
      }
      .navbar-nav .nav-link {
        color: #e0e0e0;
        font-size: 1.1rem;
        margin-right: 1rem;
        transition: color 0.3s ease;
      }
      .navbar-nav .nav-link:hover {
        color: #fff;
      }
      .navbar-nav .nav-item.active .nav-link {
        color: #fff;
        font-weight: 600;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }
      .kasa-listesi {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }
      .kasa {
        background-color: #1e2125;
        border: 1px solid #2c3034;
        border-radius: 0.5rem;
        padding: 1.5rem;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .kasa:hover {
        transform: translateY(-0.5rem);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3);
      }
      .kasa h2 {
        font-size: 1.2rem;
        color: #fff;
        margin-bottom: 1rem;
      }
      .kasa p {
        font-size: 1rem;
        color: #ffc107;
      }
      .kasa-acma-alani {
        text-align: center;
        margin-top: 2rem;
      }
      #skin-donme-alani {
        width: 300px;
        height: 200px;
        overflow: hidden;
        margin: 20px auto;
        border: 2px solid #2c3034;
        border-radius: 0.5rem;
        position: relative;
        background-color: #1e2125;
      }
      #skin-penceresi {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #skin-resmi {
        max-width: 90%;
        max-height: 90%;
        border-radius: 0.25rem;
      }
      #kasa-ac-button {
        padding: 0.75rem 1.5rem;
        font-size: 1.1rem;
        color: #fff;
        background-color: #ffc107;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 1rem;
      }
      #kasa-ac-button:hover {
        background-color: #e0a800;
        transform: translateY(-0.25rem);
      }
      #bakiye-ekle-form {
        background-color: #1e2125;
        padding: 2rem;
        border-radius: 0.5rem;
        margin-top: 2rem;
        border: 1px solid #2c3034;
      }
      #bakiye-ekle-form h1 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .form-group label {
        color: #e0e0e0;
        font-size: 1rem;
        margin-bottom: 0.5rem;
      }
      .form-control {
        background-color: #2c3034;
        border: 1px solid #343a40;
        color: #fff;
        border-radius: 0.25rem;
        padding: 0.75rem;
        font-size: 1rem;
      }
      .form-control:focus {
        border-color: #ffc107;
        box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25);
      }
      .btn-primary {
        background-color: #ffc107;
        color: #0c0d0e;
        border: none;
        padding: 0.75rem 1.5rem;
        font-size: 1.1rem;
        border-radius: 0.5rem;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 1rem;
      }
      .btn-primary:hover {
        background-color: #e0a800;
        transform: translateY(-0.25rem);
      }
      .kazanilan-skinler-listesi {
        margin-top: 2rem;
      }
      .kazanilan-skinler-listesi h1 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .kazanilan-skinler-listesi ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .kazanilan-skinler-listesi li {
        background-color: #1e2125;
        border: 1px solid #2c3034;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 0.5rem;
        font-size: 1rem;
        color: #fff;
      }
      .alert {
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 2rem;
        font-size: 1rem;
      }
      .alert-danger {
        background-color: #721c24;
        color: #f8d7da;
        border-color: #c72e2e;
      }
      .alert-success {
        background-color: #155724;
        color: #d4edda;
        border-color: #2b8339;
      }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="{% url 'kasalar' %}">CS:GO Kasa</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item {% if request.path == '/kasa/' %}active{% endif %}">
                    <a class="nav-link" href="{% url 'kasalar' %}">Kasalar</a>
                </li>
                {% if user.is_authenticated %}
                    <li class="nav-item {% if request.path == '/bakiye/ekle/' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'bakiye_ekle' %}">Bakiye Ekle</a>
                    </li>
                    <li class="nav-item {% if request.path == '/kazanilanlar/' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'kazanilan_skinler' %}">Kazanılan Skinler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Çıkış Yap</a>
                    </li>
                    <li class="nav-item">
                      <span class="nav-link">Bakiye: {{ kullanici_profili.bakiye }}</span>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Giriş Yap</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'register' %}">Kayıt Ol</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      $(document).ready(function() {
        $('.kasa-ac-button').click(function() {
            var kasaId = $(this).data('kasa-id');
            var donmeAlani = $('#skin-donme-alani');
            var skinResmi = $('#skin-resmi');
            var kasaAcButton = $(this);

            kasaAcButton.prop('disabled', true);
            donmeAlani.css('animation', 'donme 3s ease-out 1');

            $.ajax({
                url: '/kasa/' + kasaId + '/ac_ajax/',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    setTimeout(function() {
                        skinResmi.attr('src', data.skin_resim);
                        donmeAlani.css('animation', '');
                        kasaAcButton.prop('disabled', false);
                         //bildirim
                        var bildirimDiv = $('<div class="alert alert-success" role="alert">');
                        bildirimDiv.text('Tebrikler! Yeni bir skin kazandınız!');
                        $('.container').prepend(bildirimDiv);

                        bildirimDiv.fadeIn(1000, function() {
                            setTimeout(function() {
                                bildirimDiv.fadeOut(1000, function() {
                                    bildirimDiv.remove();
                                });
                            }, 2000);
                        });
                    }, 3000);
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error:", status, error);
                    var bildirimDiv = $('<div class="alert alert-danger" role="alert">');
                    bildirimDiv.text('Bir hata oluştu. Lütfen tekrar deneyin.');
                    $('.container').prepend(bildirimDiv);

                    bildirimDiv.fadeIn(1000, function() {
                        setTimeout(function() {
                            bildirimDiv.fadeOut(1000, function() {
                                bildirimDiv.remove();
                            });
                        }, 2000);
                    });
                    kasaAcButton.prop('disabled', false);
                    donmeAlani.css('animation', '');
                }
            });
        });
    });
    </script>
</body>
</html>
